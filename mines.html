<html>
<head>
	<title>Mines</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<style>
		table tr td{
			border:2px solid red;
		}
		td{
			width: 20px;
			height: 20px;
		}
		table{
			border-collapse: collapse;
		}
		img {
			width: 15px;
		}
		.saveField{
			background-color: green;
		}
	</style>
</head>
<body>
	<table>
	</table>
	Columns:<input type="number" id="sizeW" value='8' />
	Rows:<input type="number" id="sizeH" value='8' />
	<br />
	Number of Mines<input type="number" id="mines" value='10' /> 
	<br />
	<button type="button" onclick="generate()">GENERATE FIELD</button>
	<script>
		let minesPositions = [];
		let sizeW = 0;
		let sizeH = 0;
		let mines = 0;
		function generate(){
		sizeW = Number($('#sizeW').val());
		sizeH = Number($('#sizeH').val());
		mines = $('#mines').val();
			for(let row = 0; row < sizeH; row++){
				let tr = $("<tr>");
				for(let column = 0; column < sizeW; column++){
					let td = $('<td>').attr('id', `${row * sizeH + column}`);
					tr.append(td);
				}
				$("table").append(tr);
			}
			generatePositions();
			putMines();
		}

		function generatePositions(){
			let position = Math.floor(Math.random() * Number(sizeH * sizeW));
			for(let i = 0; i < mines; i++){
				while(minesPositions.includes(position)){
					position = Math.floor(Math.random() * Number(sizeH * sizeW));
				}
				minesPositions.push(position);
			}
			console.log(minesPositions);
		}

			
		function putMines(){
			for(let i=0; i < mines; i++){
				$(`#${minesPositions[i]}`).html('<img src="download.jpg" alt="mina" />').addClass('boom');
			}

			$('td').on('click', function(){
				if($(this).hasClass('boom')){
					$(this).html('<img src="boom.jpg" alt="boom" />').css('background-color', 'red');
					$('img').show();
					alert('You lost');
				}else{
						calculateNum($(this).attr('id'));
				}
		});

			$('img').hide();
		}

		function calculateNum(id){
			let num = 0;
			id = Number(id);
			let surround = [];
			surround.push(id - 1);
			surround.push(id - sizeW - 1);
			surround.push(id + sizeW - 1);
			surround.push(id + 1);
			surround.push(id - sizeW + 1);
			surround.push(id + sizeW + 1);
			surround.push(id + sizeW);
			surround.push(id - sizeW);
			if(!$(`#${id}`).is(':last-child') && !$(`#${id}`).is(':first-child')){
				for (var i = 0; i < surround.length; i++) {
					if($(`#${surround[i]}`).hasClass('boom')){
						num++;
					}
				}
			}else if($('#'+id).is(':first-child')){
				surround.splice(0,3);
				for (var i = 0; i < surround.length; i++) {
					if($(`#${surround[i]}`).hasClass('boom')){
						num++;
					}
				}
			}
			else{
				surround.splice(3,3);
				for (var i = 0; i < surround.length; i++) {
					if($(`#${surround[i]}`).hasClass('boom')){
						num++;
					}
				}
			}
			
				$('#'+id).text(num);
				checkForWin();

		function checkForWin(){
				let isWinner = true;
				for(let i = 0; i < sizeW * sizeH; i++){
					if(!$('#'+i).hasClass('boom') && !$('#'+i).hasClass('saveField')){
						isWinner = false;
						break;
					}
				}
				if(isWinner){
					alert('You Win');
				}
			}
	</script>
</body>
</html>